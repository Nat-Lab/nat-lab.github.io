<html>
<head>
<title>nato-lab</title>
</head>
<body>
<pre id="disp">nato lab is a lab by nat.
and this is it's homepage.

+--------------------------+
| Mail:                    |
|   nat _at_ nat _dot_ moe |
|                          |
| Web:                     |
|   who.nat.moe            |
|   twitter.com/magicn4t   |
+--------------------------+

this page is powered by powerful (tm) ES6 Promise with xhr.
though it looks like plain text.

(c) nato-lab 2016
--------------------------------------------------------------------------------
</pre>
</body>
<script>
'use strict';
(function() {

  /* simple Promise factory for our XHRs. */
  var getRequester = function (addr) {
    return new Promise(function (resolve, reject) {
      var xhr = new XMLHttpRequest();
      xhr.open('GET', addr);
      xhr.onload = function () {
        if (this.status == 200) resolve(JSON.parse(xhr.response));
        else reject({err: xhr.statusText});
      };
      xhr.onerror = function () {
        reject({err: xhr.statusText});
      };
      xhr.send();
    });
  };

  /* 80 col! yay! */
  var lineWrapHelper = function(line, pre) {
    var arr = line.match(new RegExp('.{1,' + (80 - pre) + '}', 'g')), str = '';
    for(var i = 1; i < arr.length; i++) {
      str += '\n' + ' '.repeat(pre) + arr[i];
    }
    return arr[0] + str;
  };

  /* view */
  var disp = document.getElementById('disp');

  /* people displayer */
  var dispPeople = function(mems) {
    disp.innerHTML += 'members: \n';
    mems.forEach(function(mem) {
      var pre = 12;
      disp.innerHTML += '  ' + mem.login + ':\n';
      disp.innerHTML += '    avatar: ' + lineWrapHelper(mem.avatar_url, pre) +   '\n';
      disp.innerHTML += '       url: ' + lineWrapHelper(mem.html_url, pre) + '\n';
    });

    disp.innerHTML += '\n';
  }

  /* project displayer */
  var dispProject = function(repos) {
    disp.innerHTML += 'projects: \n';
    repos.forEach(function(repo) {
      var pre = 10;
      disp.innerHTML += '  (' + repo.stargazers_count + '*, ' + repo.forks_count + 'f, ' + (repo.fork ? 'F' : 'S') + ')' + repo.name + ':\n';
      disp.innerHTML += '    date: ' + lineWrapHelper(repo.created_at, pre) + '\n';
      disp.innerHTML += '    desc: ' + lineWrapHelper(repo.description, pre) + '\n';
      if (repo.homepage) disp.innerHTML += '    home: ' + lineWrapHelper(repo.homepage, pre) + '\n';
      disp.innerHTML += '    lang: ' + lineWrapHelper(repo.language, pre) + '\n';
      disp.innerHTML += '    last: ' + lineWrapHelper(repo.updated_at, pre) + '\n';
      disp.innerHTML += '     url: ' + lineWrapHelper(repo.html_url, pre) + '\n\n';
    });
  }

  /* error handler factory */
  var gotErr = function (errMaker) {
    return function(errMsg) {
      disp.innterHTML += 'sorry, our ' + errMaker + ' did not make it becasue of ' + errMsg;
    }
  };

  /* get resources */
  getRequester('https://api.github.com/orgs/nat-lab/members')
    .then(dispPeople)
    .catch(new gotErr('member displayer'));

  getRequester('https://api.github.com/orgs/nat-lab/repos')
    .then(dispProject)
    .catch(new gotErr('project displayer'));

  if(!window.Promise) disp.innerHTML += lineWrapHelper('guess what? your browser does not support Promise. just visit https://github.com/nat-lab instead.', 0);

})();
</script>
</html>
